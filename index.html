<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f1a" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <title>Tip Split</title>

  <style>
    :root{
      --bg:#070a12;
      --panel:#0b0f1a;
      --card:#0f1526;
      --line:rgba(255,255,255,.08);
      --text:#eef2ff;
      --muted:rgba(238,242,255,.68);
      --brand:#3b82f6;
      --good:#22c55e;
      --bad:#fb7185;
      --tap:50px;
      --r:18px;
      --shadow: 0 12px 34px rgba(0,0,0,.45);
      font-family:-apple-system, system-ui;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      color:var(--text);
      background: linear-gradient(180deg, var(--bg), #04060b);
      min-height:100vh;
    }

    header{
      padding:14px 16px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }

    h1{ margin:0; font-size:18px; }

    .manageBtn{
      background:#111827;
      border:1px solid var(--line);
      border-radius:10px;
      padding:8px 12px;
      color:white;
      cursor:pointer;
    }

    .wrap{ max-width:800px; margin:auto; padding:16px; }

    input,select,button{
      width:100%;
      height:50px;
      margin:5px 0;
      border-radius:12px;
      border:none;
      padding:0 10px;
      background:#111827;
      color:white;
    }

    .row{display:flex;gap:10px;}

    .table{margin-top:10px;}
    .person{display:flex;gap:10px;margin:5px 0;}

    .pay{
      background:#000;
      padding:10px;
      border-radius:10px;
      text-align:center;
      min-width:70px;
    }

    .remove{
      width:50px;
      background:#ef4444;
    }

  </style>
</head>

<body>

<header>
  <h1>Tip Split</h1>
  <button class="manageBtn" onclick="openModal()">Manage Names</button>
</header>

<div class="wrap">

<input id="totalTips" placeholder="Total Tips"/>

<select id="extraMode">
<option value="tophours">Top Hours</option>
<option value="random">Random</option>
<option value="none">Do nothing</option>
</select>

<div class="row">
<input id="quickName" list="names" placeholder="Name"/>
<datalist id="names"></datalist>
<input id="quickHours" placeholder="Hours"/>
</div>

<button onclick="add()">Add</button>
<button onclick="calc()">Calculate</button>

<div id="list"></div>

</div>

<!-- MODAL -->
<div id="modal" style="display:none;position:fixed;inset:0;background:#0008;justify-content:center;align-items:center;">
<div style="background:#111827;padding:20px;border-radius:10px;width:300px;">
<h3>Saved Names</h3>
<div id="modalList"></div>
<button onclick="closeModal()">Close</button>
</div>
</div>

<script>

const LS="names";
let people=[];

function getNames(){
return JSON.parse(localStorage.getItem(LS)||"[]");
}

function saveNames(arr){
localStorage.setItem(LS,JSON.stringify(arr));
loadNames();
}

function addName(n){
if(!n)return;
let arr=getNames();
if(!arr.includes(n))arr.push(n);
saveNames(arr);
}

function removeName(n){
let arr=getNames().filter(x=>x!==n);
saveNames(arr);
}

function loadNames(){
let dl=document.getElementById("names");
dl.innerHTML="";
getNames().forEach(n=>{
let o=document.createElement("option");
o.value=n;
dl.appendChild(o);
});
}

function add(){
let n=document.getElementById("quickName").value;
let h=parseFloat(document.getElementById("quickHours").value);
if(!n||!h)return;

people.push({name:n,hours:h});
addName(n);

document.getElementById("quickName").value="";
document.getElementById("quickHours").value="";

render();
}

function render(){
let div=document.getElementById("list");
div.innerHTML="";

people.forEach((p,i)=>{
let d=document.createElement("div");
d.className="person";

d.innerHTML=`
<input value="${p.name}" onchange="people[${i}].name=this.value">
<input value="${p.hours}" onchange="people[${i}].hours=parseFloat(this.value)">
<button class="remove" onclick="removePerson(${i})">X</button>
<div class="pay">${p.pay||"-"}</div>
`;

div.appendChild(d);
});
}

function removePerson(i){
people.splice(i,1);
render();
}

function calc(){

let total=parseInt(document.getElementById("totalTips").value);
let mode=document.getElementById("extraMode").value;

let sum=people.reduce((a,b)=>a+b.hours,0);
if(!total||!sum)return;

let rate=total/sum;

let base=people.map(p=>Math.floor(p.hours*rate));
let baseSum=base.reduce((a,b)=>a+b,0);
let extra=total-baseSum;

people.forEach((p,i)=>p.pay=base[i]);

let idxs=people.map((_,i)=>i);

if(mode==="random"){
for(let i=0;i<extra;i++){
let r=Math.floor(Math.random()*idxs.length);
people[idxs[r]].pay++;
}
}

if(mode==="tophours"){
let max=Math.max(...people.map(p=>p.hours));
let top=idxs.filter(i=>people[i].hours===max);

let each=Math.floor(extra/top.length);

top.forEach(i=>people[i].pay+=each);
extra-=each*top.length;

for(let i=0;i<extra;i++){
let r=Math.floor(Math.random()*top.length);
people[top[r]].pay++;
}
}

render();
}

function openModal(){
let list=document.getElementById("modalList");
list.innerHTML="";

getNames().forEach(n=>{
let d=document.createElement("div");
d.style.display="flex";
d.style.justifyContent="space-between";

d.innerHTML=`
<span>${n}</span>
<button onclick="removeName('${n}');openModal()">‚ùå</button>
`;

list.appendChild(d);
});

document.getElementById("modal").style.display="flex";
}

function closeModal(){
document.getElementById("modal").style.display="none";
}

loadNames();

</script>
</body>
</html>
