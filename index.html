<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Tip Split</title>

<style>
body{
  margin:0;
  font-family:-apple-system,system-ui;
  background:#0b0f1a;
  color:white;
}
.wrap{padding:16px;max-width:700px;margin:auto;}
input,select,button{
  width:100%;
  height:45px;
  margin:5px 0;
  border-radius:10px;
  border:none;
  padding:0 10px;
}
button{background:#3b82f6;color:white;font-weight:bold;}
.row{display:flex;gap:10px;}
.small{width:100px;}
.person{display:flex;gap:10px;margin:5px 0;}
.remove{width:50px;background:#ef4444;}
.pay{background:#111827;padding:10px;border-radius:10px;text-align:center;}
.top-buttons{display:flex;gap:10px;}
.top-buttons button{flex:1;}
</style>
</head>

<body>
<div class="wrap">

<h2>Tip Split</h2>

<input id="totalTips" placeholder="Total Tips"/>

<select id="mode">
<option value="tophours">Top Hours (split ties)</option>
<option value="random">Random</option>
<option value="none">Do nothing</option>
</select>

<div class="row">
<input id="name" list="names" placeholder="Name"/>
<datalist id="names"></datalist>
<input id="hours" class="small" placeholder="Hours"/>
</div>

<div class="top-buttons">
<button onclick="add()">Add</button>
<button onclick="calc()">Calculate</button>
<button onclick="manage()">Manage Names</button>
</div>

<div id="list"></div>

<h3 id="result"></h3>

</div>

<!-- MODAL -->
<div id="modal" style="display:none;position:fixed;inset:0;background:#0008;justify-content:center;align-items:center;">
<div style="background:#111827;padding:20px;border-radius:10px;width:300px;">
<h3>Saved Names</h3>
<div id="modalList"></div>
<button onclick="closeModal()">Close</button>
</div>
</div>

<script>

const LS="names";

let people=[];

// ===== STORAGE =====
function saveNames(arr){
localStorage.setItem(LS,JSON.stringify(arr));
loadNames();
}

function getNames(){
return JSON.parse(localStorage.getItem(LS)||"[]");
}

function addName(n){
if(!n)return;
let arr=getNames();
if(!arr.includes(n))arr.push(n);
saveNames(arr);
}

function removeName(n){
let arr=getNames().filter(x=>x!==n);
saveNames(arr);
}

function loadNames(){
let dl=document.getElementById("names");
dl.innerHTML="";
getNames().forEach(n=>{
let o=document.createElement("option");
o.value=n;
dl.appendChild(o);
});
}

// ===== ADD PERSON =====
function add(){
let n=document.getElementById("name").value;
let h=parseFloat(document.getElementById("hours").value);

if(!n||!h)return;

people.push({name:n,hours:h});
addName(n);

document.getElementById("name").value="";
document.getElementById("hours").value="";

render();
}

// ===== RENDER =====
function render(){
let div=document.getElementById("list");
div.innerHTML="";

people.forEach((p,i)=>{
let d=document.createElement("div");
d.className="person";

d.innerHTML=`
<input value="${p.name}" onchange="people[${i}].name=this.value">
<input class="small" value="${p.hours}" onchange="people[${i}].hours=parseFloat(this.value)">
<button class="remove" onclick="removePerson(${i})">X</button>
<div class="pay">${p.pay||"-"}</div>
`;

div.appendChild(d);
});
}

// ===== REMOVE PERSON =====
function removePerson(i){
people.splice(i,1);
render();
}

// ===== CALCULATE =====
function calc(){

let total=parseInt(document.getElementById("totalTips").value);
let mode=document.getElementById("mode").value;

let sum=people.reduce((a,b)=>a+b.hours,0);
if(!total||!sum)return;

let rate=total/sum;

let base=people.map(p=>Math.floor(p.hours*rate));
let baseSum=base.reduce((a,b)=>a+b,0);
let extra=total-baseSum;

people.forEach((p,i)=>p.pay=base[i]);

let idxs=people.map((_,i)=>i);

// RANDOM
if(mode==="random"){
for(let i=0;i<extra;i++){
let r=Math.floor(Math.random()*idxs.length);
people[idxs[r]].pay++;
}
}

// TOP HOURS (YOUR RULE)
if(mode==="tophours"){
let max=Math.max(...people.map(p=>p.hours));
let top=idxs.filter(i=>people[i].hours===max);

let each=Math.floor(extra/top.length);

top.forEach(i=>people[i].pay+=each);
extra-=each*top.length;

for(let i=0;i<extra;i++){
let r=Math.floor(Math.random()*top.length);
people[top[r]].pay++;
}
}

render();

}

// ===== MANAGE NAMES =====
function manage(){
let modal=document.getElementById("modal");
let list=document.getElementById("modalList");

list.innerHTML="";

getNames().forEach(n=>{
let d=document.createElement("div");
d.style.display="flex";
d.style.justifyContent="space-between";
d.style.marginBottom="8px";

d.innerHTML=`
<span>${n}</span>
<button onclick="removeName('${n}');manage()">‚ùå</button>
`;

list.appendChild(d);
});

modal.style.display="flex";
}

function closeModal(){
document.getElementById("modal").style.display="none";
}

// INIT
loadNames();

</script>
</body>
</html>
